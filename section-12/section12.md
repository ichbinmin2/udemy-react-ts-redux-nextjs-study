# A Look Behind The Scenes Of React & Optimization Techniques

## 목차

- [How React Really Works](#리액트가-실제로-작동하는-방식)

## 리액트가 실제로 작동하는 방식

- 리액트는 어떻게 작동되는 걸까? 지금까지 우리가 리액트에 대해 학습한 바로는 사용자 인터페이스 구축을 위한 자바스크립트 라이브러리를 일컬으며, 리액트의 핵심은 컴포넌트라는 것이다. 우리는 사용자 인터페이스를 구축하기 위해서 컴포넌트를 사용하고, 리액트는 이 컴포넌트 개념을 채택했다. 그리고 리액트는 컴포넌트를 통해 사용자 인터페이스를 효과적으로 구성하며 컴포넌트를 통해 업데이트를 진행한다. 여기서 중요한 개념이 등장하는데, 바로 리액트 DOM 이란 개념이다.

### ReactDOM

- 결론부터 말하자면, ReactDOM 은 웹에 대한 인터페이스라고 볼 수 있다. 반면 React 자체는 웹에 대해서 잘 알지 못한다. 즉 브라우저와 전혀 관계가 없는 라이브러리라는 이야기다. 리액트는 어떻게 컴포넌트를 다루는지 알고 있지만 컴포넌트에 HTML 요소들이 포함되어 있는지 혹은 허구적인 요소들이 있는지에 대해서는 전혀 알지 못한다. 이는 ReactDOM의 역할이 실제 HTML 요소들을 화면에 표시하기 위한 것이라는 이야기이기도 하다. 리액트는 그저 컴포넌트를 관리하고 상태(state) 객체를 관리하며 다른 객체의 상태(state)와 컴포넌트가 업데이트 되어 모든 정보들을 (현재 사용중인) 인터페이스에 전달할 뿐이다. 그리고 이 인터페이스란 ReactDOM 같은 것을 말한다. 이렇듯, ReactDOM 은 브라우저의 일부인 실제 DOM에 대한 작업을 하기 때문에 사용자가 보고 있는 화면에 무언가를 표시할 때 사용된다.

### 리액트가 고려하거나 신경쓰는 것들(리액트의 핵심기능)

- 리액트는 핵심 기능(컴포넌트, props, 상태(state), context 등)만을 다룬다. 즉 리액트는 컴포넌트만 신경쓴다는 의미이다.
  - 컴포넌트에 전달하는 데이터인 props를 관리한다.
  - 컴포넌트 내부의 데이터인 상태(state)를 관리한다.
    > props는 컴포넌트의 구성을 가능하게 해주며 부모-자식 컴포넌트 간의 통신을 가능하게 하는 역할이다.
  - 컴포넌트 전체(전역) 데이터인 컨텍스트(context)도 관리한다.
- 컴포넌트 내부에서 사용되는 props 와 상태(state) 또는 컨텍스트(context)가 변경이 되면, 컴포넌트 역시 리액트를 통해서 변경되며 리액트는 이 컴포넌트가 화면에 새로운 것을 표시하고 있는지에 대해서 확인한다. 화면에 뭔가를 그리려고 한다면 리액트는 ReactDOM 에게 이런 정보를 전달해서 ReactDOM 이 업데이트된 화면을 표시할 수 있게 도와준다.

### 컴포넌트와 실제 DOM과의 통신은 어떻게 작동되고 있는 걸까?

- 최종적으로 리액트가 담당하는 역할이란 가상(Virtual)의 DOM 이라는 개념을 사용하는 것이라고 볼 수 있다.

### React의 가상(Virtual) DOM

- 리액트의 가상 DOM 은 어플리케이션이 마지막에 만들어내는 컴포넌트의 트리를 결정한다. 각각의 하위 트리를 가지고 있는 컴포넌트들은 JSX 코드를 반환하는데, 이 가상 DOM은 컴포넌트 트리의 현재 모양과 최종 모양을 결정 짓는다. 가령, 상태(state)가 업데이트되면 이 업데이트되는 정보는 ReactDOM 으로 전달되어 업데이트 이전과 이후(갱신 이후)의 상태(state) 차이를 인식하고 리액트가 컴포넌트 트리를 통해 구성한 가상의 스냅샷인 가상DOM 과 일치하도록 실제 DOM을 조작하는 방법을 알 수 있게 한다.

- 앞서 여러번 거론했다시피 리액트는 상태(state)나 props, 컨텍스트(context) 그리고 컴포넌트가 변경되면 컴포넌트 함수 자체가 재실행되기 때문에 리액트는 다시 렌더링을 해준다. 하지만 이 렌더링이 실제 DOM 전체를 다시 렌더링하는 것이 아님을 명심해야 한다. 그러니까 리액트에 의해 자동으로 컴포넌트 함수가 재실행된다고 해서 실제 DOM의 각 부분들이 다시 렌더링하는 것은 아니라는 의미이다. 재실행과 렌더링을 다룰 때 컴포넌트 부분과 리액트 부분, 그리고 실제 업데이트 되는 DOM(트리)를 구분해서 이해해야 한다.

- 컴포넌트는 상태, props, 컨덱스트가 변경될 때 리렌더링 된다. 하지만 다시 렌더링이 되어도 실제 DOM 은 React가 구성한 컴포넌트의 이전 상태와 현재 상태의 실질적인 차이점을 기반으로 실질적으로 업데이트 되는 부분이 있을 때만 변경-업데이트를 해준다. 즉, 실제 DOM 은 가상의 DOM 과 비교하여 업데이트가 필요하다고 '판단'이 될 때에만 업데이트를 해준다는 뜻이다.

### React의 성능 측면에서 버츄얼 돔은 어떤 역할을 할까?

- React가 각각의 컴포넌트 메모리에 가상 DOM을 가지고 있다는 것은 성능 측면에서 무엇을 의미할까? 매번 업데이트를 할 때마다 리로드를 하고, 실제 DOM을 사용해서 브라우저에 직접 렌더링하는 경우 성능 측면에서 많은 자원이 필요하게 된다. 실제 DOM 을 이용하는 작업은 어플리케이션의 성능에 과부화를 일으킬 가능성이 높기 때문이다. 하지만 이전과 현재의 상태를 가상 DOM을 사용해서 비교-계산하여 렌더링하는 경우에는 간편하기도 하거니와, 자원도 적게 든다. 즉 성능 면에서 우수한 퍼포먼스를 보여줄 수 있다.
- 이렇게 리액트는 가상 DOM 과 실제 DOM 의 비교를 통해 최종 스냅샷과 현재의 스냅샷을 실제 DOM에 전달하는 구조를 가지고 있다. 가상 DOM을 통해 2개의 스냅샷(최종 스냅샷, 현재의 스냅샷) 간의 차이점을 알아내고 실제 DOM에 렌더링하는 방식 말이다. 그래도 이해가 되지 않는다면, 우리는 예시 코드를 통해 비교하여 이해해볼 수 있을 것이다.

```js
<div>
  <h1>Hi there!</h1>
</div>
```

- 먼저 위의 간단한 코드는 해당 코드를 담은 컴포넌트를 실행한 시점의 최종 스냅샷 상태라고 생각해보자. 그리고 여기서 상태가 변경되어, 새로운 문장을 업데이트할 수 있도록 수정해보자.

```js
<div>
  <h1>Hi there!</h1>
  <p>This is New!</p>
</div>
```

- 첫 번째 코드와 비교해보면, `<h1>` 태그 밑에 새로운 `<p>` 태그가 추가된 것을 알 수 있다. 리액트는 이 두개의 스냅샷(최종 스냅샷, 현재 스냅샷) 간의 차이점이 이 `<p>This is New!</p>` 임을 확인한다. 그리고 이러한 변경 사실을 ReactDOM 에 전달하면 ReactDOM 은 실제 DOM을 업데이트하고 이 `<p>This is New!</p>`을 집어넣는다. ReactDOM 은 전체 DOM을 재렌더링 하지 않는다. 이전에 DOM 트리에 업데이트 되었던 최종 스냅샷 내부의 코드 `<h1>`과 `<div>`는 건드리지 않고, 다만 현재의 스냅샷과 최종 스냅샷과의 차이점인 `<p>This is New!</p>` 만을 추가해서 실제 DOM 트리에 업데이트하는 것이다. 이것이 바로 백그라운드에서  리액트가 작동하는 방식이다.


#### ✓ 리액트의 가상 돔(버츄얼 돔) 정리

- 리액트의 가상돔은 상태(state)가 변경될 때마다 렌더링이 일어나고 업데이트가 되는 비효율적인 방식을 방지하기 위해 등장한 개념입니다. 리액트의 컴포넌트는 가상의 돔 트리로 리액트의 메모리에 저장되어 있으며 바로 돔 트리에 업데이트 되지 않습니다. 컴포넌트에 변동 사항이 생겨 render 함수가 호출되면 리액트는 이전의 돔 트리와 비교해서 **실질적으로 어떤 부분이 업데이트 되어야 하는지 파악**하고, 필요한 부분만 돔 트리에 업데이트를 합니다. render 함수가 여러번 업데이트-호출이 되어도 **실질적으로 보여지는 데이터가 변동**되지 않으면, 이 돔 Tree에는 전혀 영향을 주지 않습니다. 그렇기에 render 함수가 여러번 호출이 되어도 React의 성능에 큰 영향을 끼치지 않습니다.

</br>
